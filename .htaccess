# ===========================
# üîê SECURITY BASIC
# ===========================

Options -Indexes
ServerSignature Off

# Blok file sensitif
<FilesMatch "(^\.|composer\.json|composer\.lock|config\.php|php.ini|php\.ini|\.env|\.htpasswd|\.htaccess)">
    Order allow,deny
    Deny from all
</FilesMatch>

RewriteEngine On

# ===========================
# üî• BLOCK MALWARE / BACKDOOR
# ===========================

RedirectMatch 404 /(backup|backdoor|shell|uploads\/tmp|temp)/

RewriteCond %{QUERY_STRING} (\.\./|\.\.\\) [NC,OR]
RewriteCond %{QUERY_STRING} (UNION|SELECT|DROP|INSERT|CAST|CONCAT|DECLARE) [NC]
RewriteRule ^ - [F]

RewriteCond %{QUERY_STRING} (base64_encode|eval\(|system\(|shell_exec|passthru|exec) [NC]
RewriteRule ^ - [F]

# ===========================
# üîÑ CLEAN URL / NO .PHP
# ===========================

# Abaikan folder admin
RewriteRule ^admin(/.*)?$ - [L]

# HOME tanpa /index.php
RewriteRule ^index\.php$ / [L,R=301]

# Hapus .php di semua file front-end
RewriteCond %{THE_REQUEST} \s/+([^?]*)\.php[\s?] [NC]
RewriteRule ^ %1 [R=301,L]

# Rewrite ke file .php sebenarnya
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.+)$ $1.php [L,QSA]

# ===========================
# üìÅ SECURITY UPLOADS
# ===========================
RewriteRule ^uploads/.*\.(php|php5|phtml|html)$ - [F,L]
AddType text/plain .php .phtml .php5 .html

# ===========================
# üõ° HOTLINK PROTECTION
# ===========================
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !yourdomain.com [NC]
RewriteCond %{HTTP_REFERER} !localhost [NC]
RewriteRule \.(jpg|jpeg|png|gif|webp)$ - [L]
