# ===========================
# üîê SECURITY & URL CLEANING
# ===========================

Options -Indexes
ServerSignature Off

# Blok Akses ke File Sensitif
<FilesMatch "(^\.|composer\.json|composer\.lock|config\.php|php.ini|php\.ini|\.env|\.htpasswd|\.htaccess)">
    Order allow,deny
    Deny from all
</FilesMatch>

# ===========================
# üîê SECURITY: BLOCK MALWARE & BACKDOOR
# ===========================

RewriteEngine On

# Blok akses folder berbahaya
RedirectMatch 404 /(backup|backdoor|shell|uploads\/tmp|temp)/

# SQL Injection basic block
RewriteCond %{QUERY_STRING} (\.\./|\.\.\\) [NC,OR]
RewriteCond %{QUERY_STRING} (UNION|SELECT|DROP|INSERT|CAST|CONCAT|DECLARE) [NC]
RewriteRule ^(.*)$ - [F,L]

# Blok eval, base64, system, shell_exec di URL
RewriteCond %{QUERY_STRING} (base64_encode|eval\(|system\(|shell_exec|passthru|exec) [NC]
RewriteRule ^(.*)$ - [F,L]

# ===========================
# üîÑ CLEAN URL (TANPA .php)
# ===========================

# Abaikan folder admin
RewriteRule ^admin(/.*)?$ - [L]

# Hapus index.php dari home
RewriteRule ^index\.php$ / [L,R=301]

# Hapus .php dari URL
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.php -f
RewriteRule ^(.+)$ $1.php [L]

# ===========================
# üìÅ SECURITY UNTUK FOLDER UPLOADS
# ===========================

# Blok eksekusi PHP di semua file uploads
RewriteRule ^uploads/.*\.(php|php5|phtml|html)$ - [F,L]

# Blok script dalam file gambar
AddType text/plain .php .phtml .php5 .html

# ===========================
# üõ° PROTECTION AGAINST HOTLINK
# ===========================
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !yourdomain.com [NC]
RewriteCond %{HTTP_REFERER} !localhost [NC]
RewriteRule \.(jpg|jpeg|png|gif|webp)$ - [L]
